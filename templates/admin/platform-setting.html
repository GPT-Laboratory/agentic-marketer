{% extends "admin/base.html" %}

{% block extra_css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">
<style>
    .-field::after {
        content: " *";
        color: red;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">Platfrom Settings</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <script>
        toastr.{ { category } } ('{{ message }}');
    </script>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">General Settings</h6>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('main.platform_settings') }}" enctype="multipart/form-data">
                <!-- Email Section -->
                <div class="border rounded p-3 mb-4 bg-light">
                    <h5 class="mb-3">‚úâÔ∏è Email Settings</h5>

                    <div class="mb-3">
                        <label class="form-label">SMTP SERVER </label>
                        <input type="text" class="form-control" name="SMTP_SERVER"
                            value="{{ settings.get('SMTP_SERVER', '') }}"  placeholder="e.g. mail.gpt-lab.eu">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">SMTP PORT </label>
                        <input type="number" class="form-control" name="SMTP_PORT"
                            value="{{ settings.get('SMTP_PORT', '') }}"  placeholder="e.g. 465">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">SMTP Username </label>
                        <input type="email" class="form-control" name="SMTP_USERNAME"
                            value="{{ settings.get('SMTP_USERNAME', '') }}" 
                            placeholder="e.g. newsle2tter@gpt-lab.eu">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">SMTP Password </label>
                        <input type="password" class="form-control" name="SMTP_PASSWORD"
                            value="{{ settings.get('SMTP_PASSWORD', '') }}"  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                </div>

                <!-- WordPress Section -->
                <div class="border rounded p-3 mb-4 bg-light">
                    <h5 class="mb-3">üìù WordPress Settings</h5>
                    <div class="mb-3">
                        <label class="form-label">Site URL </label>
                        <input type="text" class="form-control" name="wp_site_url" placeholder="yourblog.wordpress.com"
                            value="{{ settings.get('wp_site_url', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Username </label>
                        <input type="text" class="form-control" name="wp_username"
                            value="{{ settings.get('wp_username', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Application Password </label>
                        <input type="password" class="form-control" name="wp_app_password"
                            value="{{ settings.get('wp_app_password', '') }}" >
                    </div>
                </div>

                <!-- LinkedIn Section -->
                <div class="border rounded p-3 mb-4 bg-light">
                    <h5 class="mb-3">üíº LinkedIn Settings</h5>
                    <div class="mb-3">
                        <label class="form-label">Client ID </label>
                        <input type="text" class="form-control" name="linkedin_client_id"
                            value="{{ settings.get('linkedin_client_id', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Client Secret </label>
                        <input type="text" class="form-control" name="linkedin_client_secret"
                            value="{{ settings.get('linkedin_client_secret', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Redirect URI </label>
                        <input type="text" class="form-control" name="linkedin_redirect_uri"
                            value="{{ settings.get('linkedin_redirect_uri', 'https://localhost') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Organization URN </label>
                        <input type="text" class="form-control" name="linkedin_org_id"
                            value="{{ settings.get('linkedin_org_id', '') }}" placeholder="urn:li:organization:123456"
                            >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Auth Code (Manual One-Time)</label>
                        <input type="text" class="form-control" name="linkedin_auth_code"
                            value="{{ settings.get('linkedin_auth_code', '') }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Access Token</label>
                        <input type="text" class="form-control" name="linkedin_access_token"
                            value="{{ settings.get('linkedin_access_token', '') }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Refresh Token</label>
                        <input type="text" class="form-control" name="linkedin_refresh_token"
                            value="{{ settings.get('linkedin_refresh_token', '') }}">
                    </div>
                </div>

                <!-- Twitter / X Section -->
                <div class="border rounded p-3 mb-4 bg-light">
                    <h5 class="mb-3">üê¶ X (Twitter) Settings</h5>
                    <div class="mb-3">
                        <label class="form-label">API Key </label>
                        <input type="text" class="form-control" name="x_api_key"
                            value="{{ settings.get('x_api_key', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">API Secret </label>
                        <input type="text" class="form-control" name="x_api_secret"
                            value="{{ settings.get('x_api_secret', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Access Token </label>
                        <input type="text" class="form-control" name="x_access_token"
                            value="{{ settings.get('x_access_token', '') }}" >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Access Token Secret </label>
                        <input type="text" class="form-control" name="x_access_token_secret"
                            value="{{ settings.get('x_access_token_secret', '') }}" >
                    </div>
                </div>


                <!-- Submit -->
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">üíæ Save All Settings</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script>

    // Handle form submission
    document.querySelector('form').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);


        fetch(this.action, {
            method: 'POST',
            body: formData
        }).then(response => response.json())
            .then(data => {
                if (data.type === 'success') {
                    toastr.success(data.message);
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    toastr.error(data.message);
                }
            })
            .catch(error => {
                toastr.error('An error occurred while saving settings');
            });
    });
</script>
{% endblock %}